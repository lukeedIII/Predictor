{
    "_meta": {
        "name": "Nexus Shadow-Quant",
        "version": "v5.0 Stable Beta Testing",
        "type": "Desktop Application (Electron + React + Python)",
        "description": "Institutional-grade Bitcoin prediction and autonomous paper trading platform. Uses ensemble ML (XGBoost + LSTM) with quantitative finance features to generate 15-minute BTC/USDT price predictions and auto-trade them via a paper trading engine with professional risk management.",
        "target_asset": "BTC/USDT",
        "timeframe": "1-minute candles",
        "prediction_horizon": "15 minutes",
        "last_updated": "2026-02-13",
        "author": "G-luc",
        "important_note": "This file is the single source of truth for any AI agent working on this project. Read it fully before making any changes. Always update this file when adding features or changing architecture."
    },
    "project_structure": {
        "root": "F:/Predictor",
        "layout": {
            ".env.example": "Template for API keys (Binance, Gemini, OpenAI, Telegram)",
            ".gitignore": "Git exclusions — OLD-Stuff, node_modules, release, data, models, logs",
            "README.md": "Project overview and AI agent onboarding instructions",
            "requirements.txt": "Python pip dependencies for dev environment",
            "PROJECT_INSTRUCTIONS.json": "THIS FILE — comprehensive AI agent instructions",
            "build_scripts/": "PowerShell scripts for building the installer",
            "data/": "Runtime data — market CSVs, trade logs, parquet files (generated, not committed)",
            "models/": "Trained ML model files — .joblib (XGBoost), .pth (LSTM), .pkl (scaler/ensemble)",
            "logs/": "Application logs (session, data collector, events)",
            "tests/": "Python unit tests (pytest)",
            "desktop/": "★ THE ENTIRE APPLICATION — Electron + React frontend + Python backend",
            "OLD-Stuff/": "Archived old files — DO NOT USE, kept for reference only"
        },
        "desktop_app_structure": {
            "desktop/electron/": {
                "main.js": "Electron main process — window lifecycle, Python spawn, splash screen, system tray, IPC handlers",
                "preload.js": "Exposes electronAPI (minimize, maximize, close) to renderer via contextBridge",
                "splash.html": "Boot splash screen with real-time progress from /api/boot-status"
            },
            "desktop/src/": {
                "App.tsx": "Root React component — routing, Titlebar, Sidebar, StatusBar, ErrorBoundary",
                "index.css": "ALL styles — design system, components, pages, animations (~1860 lines)",
                "main.tsx": "React entry point — renders App into #root",
                "pages/": {
                    "Dashboard.tsx": "Main dashboard — status cards, PriceChart, PredictionCard, QuantHUD, NewsFeed",
                    "PaperTrading.tsx": "Trading interface — positions table, equity chart, trade history, bot controls",
                    "NexusAgent.tsx": "AI chat interface — Dr. Nexus quant analyst, real-time market context",
                    "Settings.tsx": "API key management, system info, data root display",
                    "FirstRunSetup.tsx": "One-time setup wizard — API key entry, system check, initial training"
                },
                "components/": {
                    "PriceChart.tsx": "Interactive candlestick chart (Plotly.js) with multi-timeframe support",
                    "PredictionCard.tsx": "Current prediction display — direction, confidence, regime, model weights",
                    "QuantHUD.tsx": "Quantitative indicators HUD — Hurst, RSI, MACD, volatility, FFT cycles",
                    "NewsFeed.tsx": "Live crypto news aggregation from CryptoPanic + CoinGecko + internal signals"
                },
                "hooks/": {
                    "useApi.ts": "REST API hook — auto-polling with configurable intervals, error handling",
                    "useWebSocket.tsx": "WebSocket provider — real-time price/prediction/position push updates",
                    "useKeyboardShortcuts.ts": "Global keyboard shortcuts (Ctrl+1-4 navigation, Ctrl+B bot toggle)"
                }
            },
            "desktop/python_backend/": "★ ALL PYTHON SOURCE CODE — see 'backend_modules' section below",
            "desktop/python_embedded/": "Embedded CPython 3.12 runtime for the installed .exe (not for dev)",
            "desktop/release/": "Built installer output — Nexus Shadow-Quant Setup 5.0.0.exe (~2GB)",
            "desktop/dist/": "Vite production build output (generated by npm run build)"
        }
    },
    "tech_stack": {
        "frontend": {
            "framework": "React 18 (TypeScript)",
            "bundler": "Vite 6",
            "desktop_shell": "Electron 40",
            "charting": "Plotly.js (react-plotly.js)",
            "routing": "react-router-dom v7",
            "state_management": "React hooks (useState, useEffect, useCallback) — no Redux",
            "styling": "Vanilla CSS with CSS custom properties (design tokens)",
            "design_language": "FinTech dark mode — glassmorphism, gradients, micro-animations"
        },
        "backend": {
            "language": "Python 3.12",
            "api_framework": "FastAPI + Uvicorn",
            "ml_models": [
                "XGBoost",
                "PyTorch LSTM (3-layer, 512 hidden)"
            ],
            "data_processing": [
                "Pandas",
                "NumPy",
                "SciPy"
            ],
            "visualization": "Plotly (server-side chart generation)",
            "persistence": [
                "CSV files",
                "Parquet files",
                "SQLite (nexus_brain.db)",
                "JSON (positions)"
            ],
            "api_keys_storage": ".env file in data root"
        },
        "infrastructure": {
            "build_tool": "electron-builder (NSIS installer for Windows)",
            "package_manager": "npm",
            "testing": "pytest (Python unit tests)",
            "data_source": "Binance public REST API (ccxt library)",
            "ai_providers": [
                "Google Gemini (primary)",
                "OpenAI GPT (fallback)"
            ],
            "gpu_support": "CUDA via PyTorch (auto-detects, falls back to CPU)"
        }
    },
    "backend_modules": {
        "config.py": {
            "purpose": "Central configuration — paths, API keys, trading parameters, intervals",
            "key_constants": {
                "API_PORT": 8420,
                "SYMBOL": "BTC/USDT",
                "TIMEFRAME": "1m",
                "PAPER_STARTING_BALANCE": 10000,
                "PAPER_DEFAULT_LEVERAGE": 10,
                "PAPER_MIN_CONFIDENCE": 30,
                "PAPER_COOLDOWN_SEC": 60,
                "PAPER_MAX_HOLD_SEC": 7200,
                "PAPER_MAX_DRAWDOWN": 0.20,
                "RETRAIN_INTERVAL_HOURS": 6,
                "UPDATE_INTERVAL_SEC": 60
            },
            "runtime_modes": {
                "dev": "DATA_ROOT = project directory (F:/Predictor/desktop/python_backend/)",
                "installed": "DATA_ROOT = C:/Users/<user>/AppData/Local/nexus-shadow-quant/"
            }
        },
        "predictor.py": {
            "purpose": "Core ML prediction engine — feature engineering + model training + ensemble inference",
            "classes": {
                "NexusLSTM": {
                    "type": "PyTorch nn.Module",
                    "architecture": "3-layer LSTM (512 hidden) → Linear(512→128) → ReLU → Dropout(0.3) → Linear(128→1) → Sigmoid",
                    "input": "30-timestep sequences of ~35 features",
                    "output": "Probability [0,1] — above 0.5 = bullish, below 0.5 = bearish"
                },
                "NexusPredictor": {
                    "key_methods": {
                        "__init__": "Loads models from disk, auto-detects CUDA/CPU, initializes MathCore",
                        "train()": "Full training pipeline: load data → engineer features → create targets → temporal split → train XGBoost + LSTM → validate → save models",
                        "predict()": "Loads recent 500 candles → engineers features → runs XGBoost + LSTM ensemble → returns direction, confidence, regime",
                        "_engineer_features()": "60+ scale-invariant features: returns, volatility, RSI, MACD, Bollinger, Hurst, order flow imbalance, Hawkes intensity, Wasserstein distance",
                        "_add_alt_data_features()": "FREE alternative data: Fear & Greed Index, Binance order book depth, trade pressure",
                        "create_target_variable()": "15-min forward return with 0.3% threshold (covers fees + slippage)"
                    },
                    "ensemble_strategy": "Dynamic weighted average: xgb_weight + lstm_weight (LSTM weight earned via validation accuracy, starts at 0)"
                }
            },
            "feature_groups": [
                "Price returns (1m, 5m, 15m, 1h, 4h, 24h)",
                "Volatility (rolling std, ATR, Parkinson, Garman-Klass)",
                "Momentum (RSI, MACD, Stochastic, Williams %R, CCI, ADX, Aroon)",
                "Volume (VWAP ratio, OBV slope, volume z-score, buy/sell pressure)",
                "Market microstructure (spread estimate, Amihud illiquidity, Kyle lambda)",
                "Statistical (Hurst exponent, skewness, kurtosis)",
                "Advanced quant (Hawkes process intensity, Wasserstein distance)",
                "Cross-asset (ETH/BTC correlation, PAXG/BTC correlation)",
                "Alternative data (Fear & Greed, order book imbalance)"
            ]
        },
        "paper_trader.py": {
            "purpose": "Autonomous paper trading engine with professional risk management",
            "classes": {
                "Position": {
                    "fields": [
                        "direction",
                        "entry_price",
                        "size_usd",
                        "leverage",
                        "confidence",
                        "regime",
                        "tp_price",
                        "sl_price",
                        "trailing_sl",
                        "hurst"
                    ],
                    "features": [
                        "Trailing stop-loss (activates at 0.3% profit, trails 50% of best)",
                        "Liquidation simulation",
                        "TP/SL tracking"
                    ]
                },
                "PaperTrader": {
                    "key_methods": {
                        "evaluate_signal()": "Signal confirmation — requires 2+ consecutive same-direction predictions. Filters: Hurst exponent dead zone (0.48-0.52 = skip), regime detection, drawdown circuit breaker",
                        "open_position()": "Opens position with Kelly Criterion sizing, 2:1 reward-to-risk TP/SL, ATR-based levels",
                        "update()": "Main tick loop — checks TP/SL/liquidation on all positions, evaluates new signals, enforces cooldown + max hold time",
                        "close_position()": "Closes position, logs trade to CSV, updates equity curve, triggers adaptive confidence adjustment",
                        "kelly_fraction()": "f* = (p*b - q) / b, capped at 25% (half-Kelly)",
                        "get_stats()": "Comprehensive stats: win rate, total PnL, Sharpe ratio, max drawdown, avg hold time, trade count"
                    },
                    "concurrent_positions": 3,
                    "risk_features": [
                        "Kelly Criterion position sizing",
                        "Circuit breaker (20% max drawdown)",
                        "Cooldown timer (60s between trades)",
                        "Max hold time (2 hours)",
                        "Trailing stop-loss",
                        "Adaptive confidence threshold"
                    ]
                }
            },
            "persistence": {
                "trades": "CSV at data/paper_trades.csv — append-only trade log",
                "equity": "CSV at data/paper_equity.csv — snapshots after each trade",
                "positions": "JSON at data/paper_positions.json — crash recovery for open positions"
            }
        },
        "api_server.py": {
            "purpose": "FastAPI REST API — serves all data to Electron frontend. 42KB, 1156 lines, 59 endpoints/functions",
            "port": 8420,
            "boot_sequence": [
                "10% — Load MathCore (FFT, Hurst, indicators)",
                "25% — Connect to Binance (DataCollector)",
                "40% — Download latest market data",
                "55% — Initialize NexusPredictor (load models)",
                "70% — Check model status → train if first run",
                "85% — Initialize PaperTrader (crash recovery)",
                "100% — All systems online"
            ],
            "endpoint_groups": {
                "system": [
                    "GET /api/boot-status — Real-time boot progress for splash screen",
                    "GET /api/status — System health: device, model status, validation accuracy, bot state",
                    "GET /api/system-check — Hardware compatibility (CUDA, RAM, disk)",
                    "POST /api/shutdown — Graceful shutdown"
                ],
                "prediction": [
                    "GET /api/prediction — Current prediction: direction, confidence, regime, features, quant metrics",
                    "GET /api/market-data?interval=1m&limit=200 — OHLCV candles with aggregation",
                    "GET /api/cycles — FFT market cycle analysis"
                ],
                "trading": [
                    "GET /api/positions — Open positions with live PnL",
                    "GET /api/trade-history?limit=50 — Closed trade log",
                    "GET /api/equity-history — Balance over time",
                    "GET /api/stats — Comprehensive trading statistics",
                    "POST /api/trade — Open manual position {direction: 'LONG'|'SHORT'}",
                    "POST /api/close — Close position {position_index, reason}",
                    "POST /api/close-all — Close all positions",
                    "POST /api/bot/start — Start auto-trading loop",
                    "POST /api/bot/stop — Stop auto-trading"
                ],
                "training": [
                    "POST /api/train — Trigger manual model retrain",
                    "GET /api/retrain-status — Auto-retrain scheduler state"
                ],
                "agent": [
                    "POST /api/agent/chat — Chat with Dr. Nexus AI analyst {message, session_id}",
                    "GET /api/agent/state — Raw state snapshot used by agent",
                    "GET /api/agent/history?session_id=&limit=50 — Chat history",
                    "GET /api/agent/knowledge — Learned knowledge items",
                    "GET /api/agent/memory-stats — Memory system statistics",
                    "POST /api/agent/new-session — Start new chat session"
                ],
                "settings": [
                    "GET /api/settings — Current settings with masked API keys",
                    "POST /api/settings — Save/update API keys to .env",
                    "POST /api/settings/validate — Test API key against provider"
                ],
                "first_run": [
                    "GET /api/first-run/status — Check if first-run setup needed",
                    "POST /api/first-run/trigger — Start first-run setup"
                ],
                "news": [
                    "GET /api/news — Aggregated crypto news (CryptoPanic + CoinGecko + internal signals)"
                ]
            },
            "background_tasks": {
                "auto_retrain": "Every 6 hours — retrains model with latest data, logs to retrain_history.json",
                "auto_trade": "When bot is started — polls prediction every 60s, evaluates signals, manages positions"
            }
        },
        "math_core.py": {
            "purpose": "Quantitative math engine — technical indicators, statistical analysis, FFT cycles",
            "key_functions": [
                "calculate_hurst_exponent",
                "detect_regime",
                "fft_cycle_analysis",
                "calculate_rsi",
                "calculate_macd",
                "calculate_bollinger",
                "calculate_atr"
            ]
        },
        "data_collector.py": {
            "purpose": "Binance market data fetcher — downloads OHLCV candles, saves to CSV/Parquet",
            "data_source": "Binance public REST API via ccxt",
            "output_format": "CSV + Parquet with columns: timestamp, open, high, low, close, volume"
        },
        "nexus_agent.py": {
            "purpose": "AI chat agent (Dr. Nexus) — context-aware market analysis using Gemini/OpenAI",
            "features": [
                "Live market context injection",
                "Trade history awareness",
                "Persistent memory (SQLite)",
                "Knowledge extraction and storage",
                "Multi-session conversation support"
            ]
        },
        "nexus_memory.py": {
            "purpose": "SQLite-based persistent memory for the AI agent — conversations, knowledge items, learning"
        },
        "quant_models.py": {
            "purpose": "Heavy quantitative analysis models — 83KB of pure math. Used during feature engineering",
            "note": "Largest file in the project. Contains advanced statistical models and indicators."
        },
        "alt_data.py": {
            "purpose": "Alternative data sources (all FREE) — Fear & Greed Index, Google Trends, Binance order book depth"
        },
        "sentiment_engine.py": {
            "purpose": "Crypto sentiment analysis from news/social data"
        },
        "backtester.py": {
            "purpose": "Historical backtesting engine — tests predictions against past price data"
        }
    },
    "design_system": {
        "file": "desktop/src/index.css",
        "css_variables": {
            "colors": {
                "--bg-0": "#080B12 (deepest background)",
                "--bg-1": "#0D1117 (panels)",
                "--bg-2": "#161B22 (cards)",
                "--surface-1": "rgba(22,27,34,0.6) (glass surfaces)",
                "--surface-2": "rgba(30,36,48,0.5) (input backgrounds)",
                "--accent": "#6366F1 (indigo — primary brand color)",
                "--positive": "#00D99C (green — profit/bullish)",
                "--negative": "#F44336 (red — loss/bearish)",
                "--warning": "#FFB74D (amber — warnings)",
                "--text-1": "#F0F6FC (primary text)",
                "--text-2": "#C9D1D9 (secondary text)",
                "--text-3": "#8B949E (muted text)",
                "--text-4": "#6E7681 (subtle text)"
            },
            "glass": {
                "--glass-blur": "12px",
                "--glass-border": "rgba(255,255,255,0.06)",
                "--glass-shadow": "0 8px 32px rgba(0,0,0,0.3)"
            },
            "layout": {
                "--titlebar-height": "36px",
                "--sidebar-width": "220px",
                "--statusbar-height": "28px"
            }
        },
        "animation_classes": [
            "animate-in (fade + translateY entrance)",
            "animate-in-2 through animate-in-4 (staggered delays)",
            "pulse-glow (status indicator pulse)",
            "shimmer (loading skeleton)"
        ]
    },
    "electron_config": {
        "window": {
            "width": 1440,
            "height": 900,
            "minWidth": 1100,
            "minHeight": 700,
            "frame": false,
            "titleBarStyle": "hidden",
            "backgroundColor": "#080B12"
        },
        "ipc_channels": {
            "window-minimize": "Minimize window",
            "window-maximize": "Toggle maximize/unmaximize",
            "window-close": "Close window"
        },
        "titlebar": "Custom HTML — position: fixed, z-index: 99999 (always on top)",
        "python_spawn": "Main process spawns Python as child process on port 8420",
        "splash_screen": "Shows real-time boot progress from /api/boot-status until 'ready'"
    },
    "development": {
        "setup": {
            "prerequisites": [
                "Node.js 20+",
                "Python 3.12",
                "pip",
                "CUDA toolkit (optional, for GPU)"
            ],
            "install_steps": [
                "cd desktop && npm install",
                "pip install -r requirements.txt",
                "Copy .env.example to desktop/python_backend/.env and add API keys"
            ]
        },
        "commands": {
            "dev_mode": "cd desktop && npm run dev  (starts Vite + Electron + Python backend)",
            "build": "cd desktop && npm run build  (Vite production build only)",
            "dist": "cd desktop && npm run dist  (full build + NSIS installer → release/)",
            "test": "cd tests && pytest  (run Python unit tests)"
        },
        "dev_data_paths": {
            "market_data": "F:/Predictor/data/market_data.parquet",
            "models": "F:/Predictor/models/",
            "logs": "F:/Predictor/logs/"
        },
        "installed_data_paths": {
            "all_data": "C:/Users/<user>/AppData/Local/nexus-shadow-quant/"
        }
    },
    "testing": {
        "framework": "pytest",
        "test_files": {
            "tests/test_predictor.py": "NexusPredictor — feature engineering, LSTM, training pipeline",
            "tests/test_paper_trader.py": "PaperTrader — position management, risk controls, signal evaluation",
            "tests/test_math_core.py": "MathCore — Hurst, RSI, MACD, FFT, regime detection",
            "tests/test_data_collector.py": "DataCollector — Binance fetching, CSV/Parquet storage",
            "tests/test_quant_models.py": "Quant models — advanced statistical features"
        }
    },
    "known_patterns_and_gotchas": {
        "css_stacking": "Titlebar uses position: fixed + z-index: 99999. If adding backdrop-filter or transform to new components, they create stacking contexts — never extend beyond .main-content boundaries.",
        "feature_parity": "Features MUST be computed identically in train() and predict(). Any divergence causes distribution shift and model accuracy collapse. The _engineer_features() function handles both paths.",
        "hurst_dead_zone": "Hurst exponent 0.48-0.52 is a dead zone — model skips trading in this range. Tightened from 0.45-0.55 for more trading opportunities.",
        "data_formats": "Market data is stored as BOTH CSV and Parquet. Parquet is the primary format for training (faster). CSV is kept for human readability and debugging.",
        "dev_vs_installed": "config.py auto-detects runtime mode. In dev mode, data lives at project root. In installed mode, data lives in AppData. Never hardcode paths.",
        "api_server_size": "api_server.py is 42KB / 1156 lines. It's the monolith that serves everything. If refactoring, consider splitting into routers but keep the single-file simplicity for now.",
        "ensemble_weights": "LSTM starts with weight=0 and earns ensemble weight via validation accuracy. If LSTM accuracy > XGBoost, it gets proportional weight. Saved to ensemble_state_v3.pkl."
    },
    "roadmap_and_todos": [
        "Add System Health panel (GPU info, last train time, next retrain, model accuracy)",
        "WebSocket push for real-time updates (partially implemented in useWebSocket.tsx)",
        "Real trading integration (Binance API with actual orders — requires extensive testing)",
        "Multi-timeframe analysis (combine 1m, 5m, 15m predictions)",
        "Portfolio diversification (add ETH, SOL trading pairs)",
        "Mobile companion app (React Native or PWA)",
        "Automated backtesting dashboard"
    ]
}